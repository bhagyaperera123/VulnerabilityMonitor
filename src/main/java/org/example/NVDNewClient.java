//package org.example;
//
//
//import java.io.File;
//import java.net.URI;
//import java.net.http.HttpClient;
//import java.net.http.HttpRequest;
//import java.net.http.HttpResponse;
//import java.time.LocalDateTime;
//import java.time.format.DateTimeFormatter;
//import java.util.HashSet;
//import java.util.Set;
//import javax.xml.parsers.DocumentBuilder;
//import javax.xml.parsers.DocumentBuilderFactory;
//import org.w3c.dom.Document;
//import org.w3c.dom.Element;
//import org.w3c.dom.Node;
//import org.w3c.dom.NodeList;
//import org.json.simple.JSONArray;
//import org.json.simple.JSONObject;
//import org.json.simple.parser.JSONParser;
//
//
//public class NVDNewClient {
//    private static final String API_URL = "https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=";
//    private static final DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd'T'HH:mm:ss.SSS");
//
//    public static void main(String[] args) {
//        try {
//            File inputFile = new File("pom.xml");
//            Set<String> dependencies = parsePomFile(inputFile);
//            for (String dependency : dependencies) {
//                fetchVulnerabilitiesForDependency(dependency);
//            }
//        } catch (Exception e) {
//            e.printStackTrace();
//        }
//    }
//
//    private static Set<String> parsePomFile(File file) {
//        Set<String> dependencies = new HashSet<>();
//        try {
//            DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
//            DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
//            Document doc = dBuilder.parse(file);
//            doc.getDocumentElement().normalize();
//
//            NodeList dependencyList = doc.getElementsByTagName("dependency");
//            for (int temp = 0; temp < dependencyList.getLength(); temp++) {
//                Node nNode = dependencyList.item(temp);
//                if (nNode.getNodeType() == Node.ELEMENT_NODE) {
//                    Element eElement = (Element) nNode;
//                    //String groupId = eElement.getElementsByTagName("groupId").item(0).getTextContent();
//                    String artifactId = eElement.getElementsByTagName("artifactId").item(0).getTextContent();
//                    //dependencies.add(groupId + ":" + artifactId);
//                    dependencies.add(artifactId);
//                }
//            }
//        } catch (Exception e) {
//            e.printStackTrace();
//        }
//        return dependencies;
//    }
//
//    private static void fetchVulnerabilitiesForDependency(String dependency) {
//        try {
//            HttpClient client = HttpClient.newHttpClient();
//            int startIndex = 0;
//            LocalDateTime mostRecentDate = LocalDateTime.MIN;
//            JSONObject mostRecentVulnerability = null;
//
//            while (true) {
//                String apiUrlWithDependency = API_URL + dependency + "&resultsPerPage=10&startIndex=" + startIndex;
//                HttpRequest request = HttpRequest.newBuilder()
//                        .uri(new URI(apiUrlWithDependency))
//                        .header("key", "")
//                        .build();
//
//                HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());
//                JSONParser parser = new JSONParser();
//                JSONObject jsonResponse = (JSONObject) parser.parse(response.body());
//
//                JSONArray vulnerabilities = (JSONArray) jsonResponse.get("vulnerabilities");
//                if (vulnerabilities.isEmpty()) {
//                    break;
//                }
//
//                for (Object obj : vulnerabilities) {
//                    JSONObject vulnerabilityWrapper = (JSONObject) obj;
//                    JSONObject vulnerability = (JSONObject) vulnerabilityWrapper.get("cve");
//                    String lastModifiedStr = (String) vulnerability.get("lastModified");
//                    LocalDateTime lastModifiedDate = LocalDateTime.parse(lastModifiedStr, formatter);
//
//                    if (lastModifiedDate.isAfter(mostRecentDate)) {
//                        mostRecentDate = lastModifiedDate;
//                        mostRecentVulnerability = vulnerability;
//                    }
//                }
//
//                startIndex += 10; // Move to the next page
//            }
//
//            if (mostRecentVulnerability != null) {
//                System.out.println("Dependency: " + dependency);
//                System.out.println("CVE ID: " + mostRecentVulnerability.get("id"));
//                System.out.println("Description: " + ((JSONObject) ((JSONArray) mostRecentVulnerability.get("descriptions")).get(0)).get("value"));
//                System.out.println("Published Date: " + mostRecentVulnerability.get("published"));
//                System.out.println("Last Modified Date: " + mostRecentVulnerability.get("lastModified"));
//                System.out.println("--------------------------------------");
//            }
//
//        } catch (Exception e) {
//            e.printStackTrace();
//        }
//    }
//}
